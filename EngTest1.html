<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Test 1</title>
    <link href="https://www.cssscript.com/wp-includes/css/sticky.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.1.3/darkly/bootstrap.min.css">
    <style>
        .container {
             margin: 150px auto; text-align: center;
             }
             
        * {
            margin: 0;
            padding: 0;
            font-family: 'Times New Roman', Times, serif;
            box-sizing: border-box;
        }

        body {
            background-image: linear-gradient(to top, #a8edea 0%, #fed6e3 100%); min-height: 100vh; overflow: hidden; 
            background: #001e4d;
        }

        .app {
            background: #fff;
            width: 90%;
            max-width: 600px;
            margin: 100px auto 0;
            border-radius: 10px;
            padding: 30px;
        }

        .app h1 {
            font-size: 25px;
            color: #001e4d;
            font-weight: 600;
            border-bottom: 1px solid #333;
            padding-bottom: 30px;
        }

        .quiz {
            padding: 20px 0;
        }

        .quiz h2 {
            font-size: 18px;
            color: #001e4d;
            font-weight: 600;
        }

        .btn {
            background: #fff;
            color: #222;
            font-style: 500;
            width: 100%;
            border: 1px solid #222;
            padding: 10px;
            margin: 10px 0;
            text-align: left;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background-color: #222;
            color: #fff;
        }

        #next-btn {
            background: #001e4d;
            color: #fff;
            font-weight: 500;
            width: 150px;
            border: 0;
            padding: 10px;
            margin: 20px auto 0;
            border-radius: 4px;
            cursor: pointer;
            display: none;
        }

        .correct {
            background: #9aeabc;
        }

        .incorrect {
            background: #ff9393;
        }

        /* CSS for slide-up effect */
        #anime-popup {
            position: fixed;
            bottom: -100%;
            /* Initially hidden below the viewport */
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            background-color: rgba(255, 255, 255, 0.9);
            /* Slight transparency */
            border: 1px solid #ddd;
            padding: 10px;
            box-shadow: 0px 4px 10px rgb(255, 255, 255);
            z-index: 1000;
            transition: bottom 0.5s ease-in-out;
            border-radius: 10px;
        }

        /* Slide-up animation when visible */
        #anime-popup.show {
            bottom: 50%;
            /* Move up to the center */
            transform: translate(-50%, 50%);
            /* Adjust to center vertically and horizontally */
        }

        /* Blurred background */
        #blur-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* Dark transparent background */
            backdrop-filter: blur(10px);
            /* Apply blur to content behind the popup */
            z-index: 999;
            /* Place it behind the popup */
            display: none;
            /* Hidden by default */
            transition: opacity 0.5s ease;
        }

        /* Show blurred background when popup is visible */
        #blur-background.show {
            display: block;
            opacity: 1;
        }
        /* Confetti canvas */
#confetti-canvas {
    display: block;
    z-index: 999999;
    pointer-events: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

    </style>
</head>

<body>
    <canvas id="confetti-canvas"></canvas> <!-- Confetti canvas -->

    <input type="hidden" id="test-name" value="English Test 1">
    <input type="hidden" id="final-score">
    <div id="blur-background"></div> <!-- Background blur layer -->
    <div id="anime-popup" style="display: none;">
        <video id="anime-video-correct" width="400" >
            <source src="Anime1.mp4" type="video/mp4">
        </video>
        <video id="anime-video-incorrect" width="400"  style="display: none;">
            <source src="Anime2.mp4" type="video/mp4">
        </video>
        <div id="popup-message" style="color: #000; font-size: 20px; font-weight: bold; margin-top: 10px;"></div>
        <!-- Correct/Incorrect message -->
    </div>

    <div class="app">
        <h1><label for="subject" name="Subject">English Test 1</label></h1>

        <div class="quiz">
            <h2 id="question">Question goes here</h2>
            <div id="answer-buttons">
                <button class="btn">Answer 1</button>
                <button class="btn">Answer 2</button>
                <button class="btn">Answer 3</button>
                <button class="btn">Answer 4</button>
            </div>
            <button id="next-btn">Next</button>
        </div>
    </div>

    <script>
        const questions = [
            {
                question: "What is the meaning of riches :?",
                answer: [
                    { text: "wealth bounties", correct: true },
                    { text: "The person who is rich", correct: false },
                    { text: "Divisions", correct: false },
                    { text: "Wealthy", correct: false },
                ]
            },
            {
                question: "Meaning of word perceiving : ",
                answer: [
                    { text: "To make a deal", correct: false },
                    { text: "To do something which is fix", correct: false },
                    { text: ": noticing, becoming conscious of", correct: true },
                    { text: "None of the above", correct: false },
                ]
            },
            {
                question: "Meaning of phrase stretches its arm?",
                answer: [
                    { text: "Relaxing ", correct: false },
                    { text: "Aims at achieving", correct: true },
                    { text: "Doing stretching exercise", correct: false },
                    { text: "None of the above", correct: false },
                ]
            },
            {
                question: "Meaning of phrase 'Narrow Domestic Wall'?",
                answer: [
                    { text: "Walls of the house ", correct: false },
                    { text: "Thin walls", correct: false },
                    { text: "Walls made up of mud", correct: false },
                    { text: "division on the basis of religion, caste, class and colour in societies and between countries of the world", correct: true },
                ]
            },
            {
                question: "Meaning of phrase 'Tireless Striving'?",
                answer: [
                    { text: "continuous efforts and struggle ", correct: true },
                    { text: "Tireless car", correct: false },
                    { text: "to drive very fast", correct: false },
                    { text: "To work hard for a short period of time", correct: false },
                ]
            },
            {
                question: "Meaning of phrase 'Ever Widening thoughts and action'?",
                answer: [
                    { text: "Action speaks louder than words ", correct: false },
                    { text: "Great thoughts", correct: false },
                    { text: "to have a broad mind and heart, and to not be narrow or shallow in one's mentality", correct: true },
                    { text: "To only think and not to take actions", correct: false },
                ]
            },
        ];

        const questionElement = document.getElementById("question");
        const answerButtons = document.getElementById("answer-buttons");
        const nextButton = document.getElementById("next-btn");


        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let answerSelected = false;

        const correctSound = new Audio('correct3-95630.mp3');
        const incorrectSound = new Audio('error-4-199275.mp3');
        const nextButtonSound = new Audio('correct-156911.mp3');

        function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

        function startQuiz() {
        // Shuffle the questions array
        shuffleArray(questions);

        // Pick the first 3 shuffled questions
        shuffledQuestions = questions.slice(0, 3);

        currentQuestionIndex = 0;
        score = 0;
        nextButton.innerHTML = "Next";
        showQuestion();
    }

        function showQuestion() {
        resetState();
        let currentQuestion = shuffledQuestions[currentQuestionIndex]; // Use shuffledQuestions instead of all questions
        let questionNo = currentQuestionIndex + 1;
        questionElement.innerHTML = questionNo + ". " + currentQuestion.question;

        currentQuestion.answer.forEach((answer, index) => {
            const button = document.createElement("button");
            button.innerHTML = answer.text;
            button.classList.add("btn");
            answerButtons.appendChild(button);
            if (answer.correct) {
                button.dataset.correct = answer.correct;
            }
            button.dataset.option = index + 1; // Set the option number
            button.addEventListener("click", selectAnswer); // Audio only plays when an answer is selected
        });
    }

    function resetState() {
        nextButton.style.display = "none";
        answerSelected = false;
        while (answerButtons.firstChild) {
            answerButtons.removeChild(answerButtons.firstChild);
        }
    }

        function selectAnswer(e) {
            const selectedBtn = e.target;
            const isCorrect = selectedBtn.dataset.correct === "true";

            // Get the anime popup, videos, and message
            const animePopup = document.getElementById("anime-popup");
            const correctVideo = document.getElementById("anime-video-correct");
            const incorrectVideo = document.getElementById("anime-video-incorrect");
            const popupMessage = document.getElementById("popup-message");
            const blurBackground = document.getElementById("blur-background");

            // Reset both videos and popup message
            correctVideo.style.display = "none";
            incorrectVideo.style.display = "none";
            popupMessage.innerHTML = "";

            if (isCorrect) {
                selectedBtn.classList.add("correct");
                correctSound.play(); // Play correct sound
                score++;

                // Show correct video and popup message
                correctVideo.style.display = "block";
                popupMessage.innerHTML = "Correct!"; // Display "Correct" message
            } else {
                selectedBtn.classList.add("incorrect");
                incorrectSound.play(); // Play incorrect sound

                // Show incorrect video and popup message
                incorrectVideo.style.display = "block";
                popupMessage.innerHTML = "Incorrect!"; // Display "Incorrect" message
            }

            // Show the anime popup and blur background
            animePopup.style.display = "block";
            animePopup.classList.add("show");
            blurBackground.classList.add("show");

            // Play the appropriate video
            const videoToPlay = isCorrect ? correctVideo : incorrectVideo;
            videoToPlay.play();

            // Hide the popup and blur background after the video ends
            videoToPlay.onended = () => {
                animePopup.classList.remove("show");
                blurBackground.classList.remove("show"); // Hide blurred background
                setTimeout(() => {
                    animePopup.style.display = "none"; // Hide after sliding out
                }, 500); // Wait for slide-out transition to finish
            };

            // Disable answer buttons and show the correct answer
            Array.from(answerButtons.children).forEach(button => {
                if (button.dataset.correct === "true") {
                    button.classList.add("correct");
                }
                button.disabled = true;
            });
            answerSelected = true;

            cancelSpeech();
            setTimeout(() => {
                nextButton.style.display = "block";
            }, 250);
        }

        function nextQuestion() {
            if (answerSelected) {
                // Play sound effect when "Next" button is clicked
                nextButtonSound.play();

                currentQuestionIndex++;
                if (currentQuestionIndex < shuffledQuestions.length) {
                    showQuestion();
                } else {
                    announceFinalScore();
                    handleFinalScore();
                    setTimeout(() => {
                        window.speechSynthesis.cancel();
                        window.location.href = "EngChp1.html";
                    }, 2000); // Wait 2 seconds to allow the announcement to finish
                    
                }
            }
        }

        function announceFinalScore() {
            const utterance = new SpeechSynthesisUtterance(`Your final score is ${score} out of ${shuffledQuestions.length}.`);

            // Select a different voice for the announcement
            const voices = window.speechSynthesis.getVoices();
            const announcementVoice = voices.find(voice => voice.name.includes('Google UK English Male') || voice.name.includes('Google US English Male'));
            if (announcementVoice) {
                utterance.voice = announcementVoice;
            } else {
                console.warn('Preferred voice not available. Using default voice.');
            }

            // Set up event handlers for speech synthesis
            utterance.onend = () => {
                console.log('Speech synthesis has finished.');
                setTimeout(() => {
                    window.location.href = "EngChp1.html";
                }, 20000); // Wait 20 seconds to allow the announcement to finish
                // Trigger confetti effect
                launchConfetti();
            };

            utterance.onerror = (event) => {
                console.error('Speech synthesis error:', event.error);
                // Redirect to the next page in case of an error
                window.location.href = "EngChp1.html";
            };

            // Start speaking
            window.speechSynthesis.speak(utterance);
        }

        // Ensure voices are loaded before using them
        window.speechSynthesis.onvoiceschanged = () => {
            const voices = window.speechSynthesis.getVoices();
            console.log('Available voices:', voices);
        };

        nextButton.addEventListener("click", function () {
            nextQuestion();
            sendScoreToPHP(score, document.getElementById("subject").value);
        });

        // Integrate speech synthesis functionality
        let enterPressCount = 0;
        const maxEnterPressCount = 3;

        function readOutLoud() {
            const chapterName = "Chapter 1"; // Change this to the actual chapter name
            const elementsToRead = [
                `Question Number ${currentQuestionIndex + 1}: ${questionElement.innerText}`,
                ...Array.from(answerButtons.children).map((btn, index) => `Option Number ${index + 1}: ${btn.innerText}`)
            ];

            // Add chapter name if it's the first question
            if (currentQuestionIndex === 0) {
                elementsToRead.unshift(`Welcome to ${"Test of , where the mind is without fear"}`);
            }

            const combinedText = elementsToRead.join('. ');
            const utterance = new SpeechSynthesisUtterance(combinedText);

            // Get the list of available voices
            const voices = window.speechSynthesis.getVoices();
            // Select a calming and friendly voice
            const calmingVoice = voices.find(voice => voice.name.includes('Google UK English Female') || voice.name.includes('Google US English Female'));
            if (calmingVoice) {
                utterance.voice = calmingVoice;
            }

            window.speechSynthesis.speak(utterance);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                enterPressCount++;
                if (enterPressCount === maxEnterPressCount) {
                    readOutLoud();
                    enterPressCount = 0; // Reset count after triggering
                }
            } else {
                enterPressCount = 0; // Reset count if other key is pressed
            }

            if (event.key >= '1' && event.key <= '4') {
                const index = parseInt(event.key) - 1;
                if (answerButtons.children[index]) {
                    answerButtons.children[index].click();
                }
            }

            if (event.key === 'Enter' && answerSelected) {
                nextQuestion();
            }
        }

        document.addEventListener('keypress', handleKeyPress);

        function cancelSpeech() {
            window.speechSynthesis.cancel();
        }

        // Ensure voices are loaded before using them
        window.speechSynthesis.onvoiceschanged = () => {
            const voices = window.speechSynthesis.getVoices();
            console.log('Available voices:', voices);
        };

        nextButton.addEventListener("click", function () {
            nextQuestion();
        });

        function sendScoreToPHP(testName, score) {
            fetch('4.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    testName: testName,
                    score: score
                })
            })
                .then(response => response.text())
                .then(data => {
                    console.log(data);  // Show response from PHP
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        }

        // Confetti function from previous code
        // Confetti code
        
        
    var maxParticleCount = 5000; // Increase max confetti count for more visibility
    var particleSpeed = 500; // Increase speed for more dynamic effect
    var startConfetti; // Call to start confetti animation
    var stopConfetti; // Call to stop adding confetti
    var toggleConfetti; // Call to start or stop the confetti animation depending on whether it's already running
    var removeConfetti; // Call to stop the confetti animation and remove all confetti immediately

    (function() {
        startConfetti = startConfettiInner;
        stopConfetti = stopConfettiInner;
        toggleConfetti = toggleConfettiInner;
        removeConfetti = removeConfettiInner;
        var colors = ["DodgerBlue", "OliveDrab", "Gold", "Pink", "SlateBlue", "LightBlue", "Violet", "PaleGreen", "SteelBlue", "SandyBrown", "Chocolate", "Crimson"];
        var streamingConfetti = false;
        var animationTimer = null;
        var particles = [];
        var waveAngle = 0;

        function resetParticle(particle, width, height) {
            particle.color = colors[(Math.random() * colors.length) | 0];
            particle.x = Math.random() * width; // Start from random horizontal position
            particle.y = Math.random() * height - height; // Start from top
            particle.diameter = Math.random() * 3 + 3; // Increase size
            particle.tilt = Math.random() * 0 - 0; // Increase tilt range
            particle.tiltAngleIncrement = Math.random() * 0.0 + 0.0; // Increase tilt speed
            particle.tiltAngle = 0;
            return particle;
        }

        function startConfettiInner() {
            var width = window.innerWidth;
            var height = window.innerHeight;
            window.requestAnimFrame = (function() {
                return window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    window.msRequestAnimationFrame ||
                    function (callback) {
                        return window.setTimeout(callback, 16.6666667);
                    };
            })();
            var canvas = document.getElementById("confetti-canvas");
            if (canvas === null) {
                canvas = document.createElement("canvas");
                canvas.setAttribute("id", "confetti-canvas");
                canvas.setAttribute("style", "display:block;z-index:999999;pointer-events:none");
                document.body.appendChild(canvas);
                canvas.width = width;
                canvas.height = height;
                window.addEventListener("resize", function() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }, true);
            }
            var context = canvas.getContext("2d");
            while (particles.length < maxParticleCount)
                particles.push(resetParticle({}, width, height));
            streamingConfetti = true;
            if (animationTimer === null) {
                (function runAnimation() {
                    context.clearRect(0, 0, window.innerWidth, window.innerHeight);
                    if (particles.length === 0)
                        animationTimer = null;
                    else {
                        updateParticles();
                        drawParticles(context);
                        animationTimer = requestAnimFrame(runAnimation);
                    }
                })();
            }
        }

        function stopConfettiInner() {
            streamingConfetti = false;
        }

        function removeConfettiInner() {
            stopConfetti();
            particles = [];
        }

        function toggleConfettiInner() {
            if (streamingConfetti)
                stopConfettiInner();
            else
                startConfettiInner();
        }

        function drawParticles(context) {
            var particle;
            var x;
            for (var i = 0; i < particles.length; i++) {
                particle = particles[i];
                context.beginPath();
                context.lineWidth = particle.diameter;
                context.strokeStyle = particle.color;
                context.moveTo(particle.x + particle.tilt + particle.diameter / 2, particle.y + particle.tilt + particle.diameter / 2);
                context.lineTo(particle.x + particle.tilt, particle.y + particle.tilt + particle.diameter);
                context.stroke();
            }
        }

        function updateParticles() {
    var width = window.innerWidth;
    var height = window.innerHeight;
    var particle;
    waveAngle += 0.01;

    for (var i = 0; i < particles.length; i++) {
        particle = particles[i];

        // Make particles fall straight down
        particle.x += 0; // No horizontal movement
        particle.y += 1.5; // Adjust this value to control the falling speed

        // Reset particles that have moved out of view
        if (particle.y > height) {
            particle.y = -10;
            particle.x = Math.random() * width;
        }

        // No tilt effect or horizontal movement
        particle.tilt = 0;
    }
}

    })();

    // Example of calling confetti celebration on an event (e.g., final score announcement)
    function handleFinalScore() {
        // Your existing code to handle final score
        startConfetti(); // Start the confetti celebration
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }



        startQuiz();

    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.min.js"></script>
</body>

</html>